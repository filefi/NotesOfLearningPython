# 第8部分 高级话题

## 第37章 Unicode和字节字符串

### 37.1 Python 3.X 中字符串的变化

Python 2.X的`str`和`unicode`类型已经融入了Python 3.X的`str`和`bytes`类型，并且增加了一种新的可变的类型`bytearray`。



### 37.2 字符串基础

#### 字符编码方式

字节和字符串之间的来回转换由两个术语定义：

- ***编码*** 是根据一个想要的编码名称，把一个字符串翻译为其原始字节形式。
- ***解码*** 是根据其编码名称，把一个原始字节串翻译为字符串形式的过程。

对于Python程序员来说，编码指定为包含了编码名的字符串。Python带有大约100种不同的编码，参见Python库参考可以找到一个完整的列表。导入`encodings`模块并运行`help(encodings)`可以查看这些编码名称。



#### Python的字符串类型

Python 3.X中有3种字符串对象类型：

- `str`表示Unicode文本，用于文本数据。
- `bytes`表示二进制数据。
- `bytearray`是一种可变的`bytes`类型。

这3种字符串类型都支持类似的操作集，但是它们都有不同的角色。

##### **`str`类型**

Python 3.X的 `str` 类型定义了一个**不可变的字符序列**，它可能是像ASCII这样的每个字符一个字节的常规文本，或者是像UTF-8 Unicode这样可能包含多字节字符的字符集文本。

##### **`bytes`类型**

Python 3.X实现了字符串和Unicode的结合，但很多程序仍然需要处理图像、声音，以及用来与设备接口的打包数据，或者想要用Python的`struct`模块处理C程序。因此，为了支持真正的二进制数据的处理，还引入了一种新的类型`bytes`。

`bytes`类型定义为一个**8位整数的不可变序列**，表示绝对的字节值。该类型支持几乎所有`str`类型的操作。

##### **`bytearray`类型**

`bytearray`类型是`bytes`类型的一个变体，它是可变的并且**支持原处修改**。它支持`str`和`bytes`所支持的常见的字符串操作，以及和列表相同的很多原处修改操作（例如，append和extend方法，以及向索引赋值）。



#### 文本和二进制文件

**Python 3.X现在对文本文件和二进制文件之间做了一个明显的独立于平台的区分：**

- **文本文件：** 当一个文件以文本模式打开的时候，读取其数据会自动将其内容解码（每个平台一个默认的或一个提供的编码名称），并且将其返回为一个`str`，写入会接受一个`str`，并且在将其传输到文件之间自动编码它。文本模式的文件还支持统一的行尾转换和额外的编码特定参数。根据编码名称，文本文件也自动处理文件开始处的字节顺序标记序列。
- **二进制文件：** 通过在内置的`open`调用的模式字符串参数添加一个`b`，以二进制模式打开一个文件的时候，读取其数据不会以任何方式解码它，而是直接返回其内容raw并且未经修改，作为一个`bytes`对象；写入类似地接受一个`bytes`对象，并且将
  其传送到文件中而未经修改。二进制模式文件也接受一个`bytearray`对象作为写入
  文件中的内容。

**以何种模式打开一个文件将决定脚本使用何种类型的对象来表示其内容：**

- 如果正在处理图像文件，其他程序创建的、而且必须解压的打包数据，或者一些设
  备数据流，则使用`bytes`和二进制模式文件处理它更合适。如果想要更新数据而不
  在内存中产生其副本，也可以选择使用`bytearray`。
- 如果你要处理的内容实质是文本的内容，例如程序输出、HTML、国际化文本或
  CSV或XML文件，可能要使用`str`和文本模式文件。

注意：内置函数`open`的模式字符串参数（函数的第二个参数）在Python 3.0中变得至关
重要，因为其内容不仅指定了一个文件处理模式，而且暗示了一个Python对象类型。例如，模式`rb`、`wb`和`rb+`暗示`bytes`，而`r`、`w+`和`rt`暗示`str`。

### 37.3 编写基础字符串





### 37.4 编写 Unicode 字符串





### 37.5 使用 3.X `bytes` 对象





### 37.6 使用 3.X/2.6+ `bytearray` 对象





### 37.7 使用文本和二进制文件





### 37.8 使用Unicode文件





### 37.9 Python 3.X 中其他字符串工具的变化







---



## 第38章 管理属性







---



## 第39章 装饰器







---



## 第40章 元类







---



## 第41章 所有美好的事物

